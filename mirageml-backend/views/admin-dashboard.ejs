<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="stats-grid">
    <div class="stat-card" style="border-left-color: #3498db;">
        <div class="stat-icon" style="background: rgba(52, 152, 219, 0.1);">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <div class="value"><%= stats.totalUsers %></div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i> –ê–∫—Ç–∏–≤–Ω—ã—Ö: <%= stats.userCount %>
            </div>
        </div>
    </div>
    <div class="stat-card" style="border-left-color: #27ae60;">
        <div class="stat-icon" style="background: rgba(39, 174, 96, 0.1);">
            <i class="fas fa-folder"></i>
        </div>
        <div class="stat-content">
            <h3>–ü—Ä–æ–µ–∫—Ç–æ–≤</h3>
            <div class="value"><%= stats.totalProjects %></div>
            <div class="stat-change">
                <i class="fas fa-database"></i> –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ
            </div>
        </div>
    </div>
    <div class="stat-card" style="border-left-color: #f39c12;">
        <div class="stat-icon" style="background: rgba(243, 156, 18, 0.1);">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
            <h3>–°–µ—Å—Å–∏–π</h3>
            <div class="value"><%= stats.totalSessions %></div>
            <div class="stat-change">
                <i class="fas fa-globe"></i> –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–π—á–∞—Å
            </div>
        </div>
    </div>
    <div class="stat-card" style="border-left-color: #9b59b6;">
        <div class="stat-icon" style="background: rgba(155, 89, 182, 0.1);">
            <i class="fas fa-comments"></i>
        </div>
        <div class="stat-content">
            <h3>–û—Ç–∑—ã–≤–æ–≤</h3>
            <div class="value"><%= stats.totalReviews %></div>
            <div class="stat-change positive">
                <i class="fas fa-check"></i> –û–¥–æ–±—Ä–µ–Ω–æ: <%= stats.approvedReviews %>
            </div>
        </div>
    </div>
</div>

<!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
<div class="charts-grid">
    <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Ä–æ–ª—è–º -->
    <div class="card chart-card">
        <div class="card-header">
            <h3><i class="fas fa-chart-pie"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Ä–æ–ª—è–º</h3>
        </div>
        <canvas id="rolesChart"></canvas>
    </div>

    <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞: –°—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–æ–≤ -->
    <div class="card chart-card">
        <div class="card-header">
            <h3><i class="fas fa-chart-pie"></i> –°—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–æ–≤</h3>
        </div>
        <canvas id="reviewsChart"></canvas>
    </div>
</div>

<!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
<div class="card">
    <div class="card-header">
        <h3><i class="fas fa-chart-line"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π</h3>
    </div>
    <canvas id="sessionsChart" height="80"></canvas>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="info-grid">
    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-code" style="color: #667eea;"></i>
            <h4>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏</h4>
        </div>
        <div class="info-value"><%= stats.developerCount %></div>
        <p class="info-desc">–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ</p>
    </div>

    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-user-shield" style="color: #f5576c;"></i>
            <h4>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</h4>
        </div>
        <div class="info-value"><%= stats.moderatorCount %></div>
        <p class="info-desc">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø</p>
    </div>

    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-shield-alt" style="color: #e74c3c;"></i>
            <h4>–ê–¥–º–∏–Ω—ã</h4>
        </div>
        <div class="info-value"><%= stats.adminCount %></div>
        <p class="info-desc">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∞</p>
    </div>

    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-user" style="color: #3498db;"></i>
            <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
        </div>
        <div class="info-value"><%= stats.userCount %></div>
        <p class="info-desc">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
    </div>

    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-check-circle" style="color: #27ae60;"></i>
            <h4>–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã</h4>
        </div>
        <div class="info-value"><%= stats.approvedReviews %></div>
        <p class="info-desc">–ü—Ä–æ—à–ª–∏ –º–æ–¥–µ—Ä–∞—Ü–∏—é</p>
    </div>

    <div class="card info-card">
        <div class="info-header">
            <i class="fas fa-hourglass-half" style="color: #f39c12;"></i>
            <h4>–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h4>
        </div>
        <div class="info-value"><%= stats.pendingReviews %></div>
        <p class="info-desc">–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</p>
    </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
<div class="card system-info">
    <div class="card-header">
        <h3><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
    </div>
    <div class="info-table">
        <div class="info-row">
            <span class="info-label">–í–µ—Ä—Å–∏—è –ø–∞–Ω–µ–ª–∏:</span>
            <span class="info-value">MirageML Admin v1.0.0</span>
        </div>
        <div class="info-row">
            <span class="info-label">–ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞:</span>
            <span class="info-value"><%= port %></span>
        </div>
        <div class="info-row">
            <span class="info-label">–î–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:</span>
            <span class="info-value"><%= new Date().toLocaleDateString('ru-RU') %></span>
        </div>
        <div class="info-row">
            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
            <span class="info-value"><span class="status-badge">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span></span>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // –î–∞–Ω–Ω—ã–µ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞
    const statsData = {
        developerCount: <%= stats.developerCount %>,
        moderatorCount: <%= stats.moderatorCount %>,
        adminCount: <%= stats.adminCount %>,
        userCount: <%= stats.userCount %>,
        approvedReviews: <%= stats.approvedReviews %>,
        pendingReviews: <%= stats.pendingReviews %>,
        totalSessions: <%= stats.totalSessions %>
    };

    // –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞
    const colors = {
        blue: '#3498db',
        green: '#27ae60',
        orange: '#f39c12',
        purple: '#9b59b6',
        red: '#e74c3c',
        teal: '#1abc9c',
        gray: '#95a5a6',
        developer: '#667eea',
        moderator: '#f5576c'
    };

    // –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const rolesCtx = document.getElementById('rolesChart').getContext('2d');
    new Chart(rolesCtx, {
        type: 'doughnut',
        data: {
            labels: ['–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã', '–ê–¥–º–∏–Ω—ã', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏'],
            datasets: [{
                data: [statsData.developerCount, statsData.moderatorCount, statsData.adminCount, statsData.userCount],
                backgroundColor: [colors.developer, colors.moderator, colors.red, colors.blue],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 12 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percent = ((context.raw / total) * 100).toFixed(1);
                            return context.label + ': ' + context.raw + ' (' + percent + '%)';
                        }
                    }
                }
            }
        }
    });

    // –î–∏–∞–≥—Ä–∞–º–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–∑—ã–≤–æ–≤
    const reviewsCtx = document.getElementById('reviewsChart').getContext('2d');
    new Chart(reviewsCtx, {
        type: 'doughnut',
        data: {
            labels: ['–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ', '–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏'],
            datasets: [{
                data: [statsData.approvedReviews, statsData.pendingReviews],
                backgroundColor: [colors.green, colors.orange],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 12 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percent = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                            return context.label + ': ' + context.raw + ' (' + percent + '%)';
                        }
                    }
                }
            }
        }
    });

    // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–π
    const sessionsCtx = document.getElementById('sessionsChart').getContext('2d');
    new Chart(sessionsCtx, {
        type: 'bar',
        data: {
            labels: ['–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', '–ü—Ä–æ–µ–∫—Ç—ã', '–°–µ—Å—Å–∏–∏', '–û—Ç–∑—ã–≤—ã'],
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                data: [
                    statsData.userCount + statsData.adminCount,
                    <%= stats.totalProjects %>,
                    statsData.totalSessions,
                    statsData.approvedReviews + statsData.pendingReviews
                ],
                backgroundColor: [
                    colors.blue,
                    colors.green,
                    colors.orange,
                    colors.purple
                ],
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        precision: 0
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        border-left: 4px solid;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
    }

    .stat-icon i {
        color: inherit;
    }

    .stat-content {
        flex: 1;
    }

    .stat-content h3 {
        color: #7f8c8d;
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-content .value {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        line-height: 1;
        margin-bottom: 8px;
    }

    .stat-change {
        font-size: 12px;
        color: #95a5a6;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .stat-change.positive {
        color: #27ae60;
    }

    /* –ì—Ä–∞—Ñ–∏–∫–∏ */
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .chart-card {
        padding: 20px;
    }

    .card-header {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #ecf0f1;
    }

    .card-header h3 {
        color: #2c3e50;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .card-header h3 i {
        color: #3498db;
    }

    canvas {
        max-height: 300px;
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .info-card {
        padding: 20px;
        text-align: center;
    }

    .info-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    .info-header h4 {
        color: #7f8c8d;
        font-size: 13px;
        font-weight: 500;
        text-transform: uppercase;
    }

    .info-value {
        font-size: 36px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .info-desc {
        color: #95a5a6;
        font-size: 13px;
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ */
    .system-info {
        padding: 25px;
    }

    .info-table {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .info-row {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .info-label {
        color: #7f8c8d;
        font-size: 13px;
    }

    .info-value {
        color: #2c3e50;
        font-weight: 600;
        font-size: 15px;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(39, 174, 96, 0.1);
        color: #27ae60;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .charts-grid {
            grid-template-columns: 1fr;
        }

        .info-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .info-table {
            grid-template-columns: 1fr;
        }
    }
</style>
